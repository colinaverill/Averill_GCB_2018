#extracting PRISM climate and NACP soil clay data. 
#extracting NADP N deposition data from 1985-2014, taking 30-year average. 
#Also extraction 30-year MAT and MAP normals from PRISM.
#Downloaded files here 06/29/16: http://nadp.sws.uiuc.edu/NTN/annualmapsByYear.aspx
rm(list=ls())
require(raster)
require(rgdal)
require(sp)
detach("package:runjags", unload=TRUE) #make sure runjags is not loaded.
source('required_products_utilities/extract_ndep.r')
source('required_products_utilities/master_path_list.r')

#load points to grab
product_1   <- readRDS(Product_1.path)
product_2   <- readRDS(Product_2.path)
product_3   <- readRDS(Product_3.path)

#isolate lat/long
points.1 <- cbind(product_1$longitude, product_1$latitude)
points.2 <- cbind(product_2$LON      , product_2$LAT     )
points.3 <- cbind(product_3$longitude, product_3$latitude)

#grab PRISM rasters
map.PRISM <- raster(map.PRISM.path)
mat.PRISM <- raster(mat.PRISM.path)

#grab NACP sand silt and clay rasters
sand <- raster(NACP.sand.raster.path)
silt <- raster(NACP.silt.raster.path)
clay <- raster(NACP.clay.raster.path)


#load all N=dep rasters
r.1985 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1985.tif')
r.1986 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1986.tif')
r.1987 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1987.tif')
r.1988 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1988.tif')
r.1989 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1989.tif')
r.1990 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1990.tif')
r.1991 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1991.tif')
r.1992 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1992.tif')
r.1993 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1993.tif')
r.1994 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1994.tif')
r.1995 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1995.tif')
r.1996 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1996.tif')
r.1997 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1997.tif')
r.1998 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1998.tif')
r.1999 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_1999.tif')
r.2000 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2000.tif')
r.2001 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2001.tif')
r.2002 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2002.tif')
r.2003 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2003.tif')
r.2004 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2004.tif')
r.2005 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2005.tif')
r.2006 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2006.tif')
r.2007 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2007.tif')
r.2008 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2008.tif')
r.2009 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2009.tif')
r.2010 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2010.tif')
r.2011 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2011.tif')
r.2012 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2012.tif')
r.2013 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2013.tif')
r.2014 <- raster('/fs/data3/caverill/NADP_NDEP/annual.N.layers/dep_totalN_2014.tif')
r.list <- c(r.1985, r.1986, r.1987, r.1988, r.1989, r.1990, r.1991, r.1992, r.1993, r.1994, r.1995, r.1996, r.1997, r.1998, r.1999, r.2000, r.2001,r.2002,r.2003, r.2004, r.2005, r.2006, r.2007, r.2008, r.2009, r.2010, r.2011, r.2012, r.2013, r.2014)

#product_1 loop
points <- points.1
#project your sites into the coordinate reference system (CRS) of each years raster
p.1985 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1985))
p.1986 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1986))
p.1987 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1987))
p.1988 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1988))
p.1989 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1989))
p.1990 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1990))
p.1991 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1991))
p.1992 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1992))
p.1993 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1993))
p.1994 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1994))
p.1995 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1995))
p.1996 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1996))
p.1997 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1997))
p.1998 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1998))
p.1999 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1999))
p.2000 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2000))
p.2001 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2001))
p.2002 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2002))
p.2003 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2003))
p.2004 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2004))
p.2005 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2005))
p.2006 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2006))
p.2007 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2007))
p.2008 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2008))
p.2009 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2009))
p.2010 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2010))
p.2011 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2011))
p.2012 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2012))
p.2013 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2013))
p.2014 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2014))

#now extract Ndep data from all layers.
d.1985 <- extract(r.1985, p.1985)
d.1986 <- extract(r.1986, p.1986)
d.1987 <- extract(r.1987, p.1987)
d.1988 <- extract(r.1988, p.1988)
d.1989 <- extract(r.1989, p.1989)
d.1990 <- extract(r.1990, p.1990)
d.1991 <- extract(r.1991, p.1991)
d.1992 <- extract(r.1992, p.1992)
d.1993 <- extract(r.1993, p.1993)
d.1994 <- extract(r.1994, p.1994)
d.1995 <- extract(r.1995, p.1995)
d.1996 <- extract(r.1996, p.1996)
d.1997 <- extract(r.1997, p.1997)
d.1998 <- extract(r.1998, p.1998)
d.1999 <- extract(r.1999, p.1999)
d.2000 <- extract(r.2000, p.2000)
d.2001 <- extract(r.2001, p.2001)
d.2002 <- extract(r.2002, p.2002)
d.2003 <- extract(r.2003, p.2003)
d.2004 <- extract(r.2004, p.2004)
d.2005 <- extract(r.2005, p.2005)
d.2006 <- extract(r.2006, p.2006)
d.2007 <- extract(r.2007, p.2007)
d.2008 <- extract(r.2008, p.2008)
d.2009 <- extract(r.2009, p.2009)
d.2010 <- extract(r.2010, p.2010)
d.2011 <- extract(r.2011, p.2011)
d.2012 <- extract(r.2012, p.2012)
d.2013 <- extract(r.2013, p.2013)
d.2014 <- extract(r.2014, p.2014)

#get ndep, MAT, MAP, sand silt, clay
out <- data.frame(d.1985,d.1986, d.1987, d.1988, d.1989, d.1990, d.1991, d.1992, d.1993, d.1994, d.1995, d.1996, d.1997, d.1998, d.1999, d.2000, d.2001, d.2002, d.2003, d.2004, d.2005, d.2006, d.2007, d.2008, d.2009, d.2010, d.2011, d.2012, d.2013, d.2014)
out$ndep <- rowMeans(out, na.rm=T)
product_1$ndep30_wet <- out$ndep
product_1$map  <- extract(map.PRISM, points)
product_1$mat  <- extract(mat.PRISM, points)
product_1$sand <- extract(sand, points)
product_1$silt <- extract(silt, points)
product_1$clay <- extract(clay, points)
#get wet and dry dep separately with new NEFI microbe function
out <- extract_ndep(product_1$longitude,product_1$latitude)
product_1 <- cbind(product_1,out)
product_1$tot.15 <- product_1$n.dep

#product_2 loop
points <- points.2
#project your sites into the coordinate reference system (CRS) of each years raster
p.1985 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1985))
p.1986 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1986))
p.1987 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1987))
p.1988 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1988))
p.1989 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1989))
p.1990 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1990))
p.1991 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1991))
p.1992 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1992))
p.1993 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1993))
p.1994 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1994))
p.1995 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1995))
p.1996 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1996))
p.1997 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1997))
p.1998 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1998))
p.1999 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1999))
p.2000 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2000))
p.2001 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2001))
p.2002 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2002))
p.2003 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2003))
p.2004 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2004))
p.2005 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2005))
p.2006 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2006))
p.2007 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2007))
p.2008 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2008))
p.2009 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2009))
p.2010 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2010))
p.2011 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2011))
p.2012 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2012))
p.2013 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2013))
p.2014 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2014))

#now extract Ndep data from all layers.
d.1985 <- extract(r.1985, p.1985)
d.1986 <- extract(r.1986, p.1986)
d.1987 <- extract(r.1987, p.1987)
d.1988 <- extract(r.1988, p.1988)
d.1989 <- extract(r.1989, p.1989)
d.1990 <- extract(r.1990, p.1990)
d.1991 <- extract(r.1991, p.1991)
d.1992 <- extract(r.1992, p.1992)
d.1993 <- extract(r.1993, p.1993)
d.1994 <- extract(r.1994, p.1994)
d.1995 <- extract(r.1995, p.1995)
d.1996 <- extract(r.1996, p.1996)
d.1997 <- extract(r.1997, p.1997)
d.1998 <- extract(r.1998, p.1998)
d.1999 <- extract(r.1999, p.1999)
d.2000 <- extract(r.2000, p.2000)
d.2001 <- extract(r.2001, p.2001)
d.2002 <- extract(r.2002, p.2002)
d.2003 <- extract(r.2003, p.2003)
d.2004 <- extract(r.2004, p.2004)
d.2005 <- extract(r.2005, p.2005)
d.2006 <- extract(r.2006, p.2006)
d.2007 <- extract(r.2007, p.2007)
d.2008 <- extract(r.2008, p.2008)
d.2009 <- extract(r.2009, p.2009)
d.2010 <- extract(r.2010, p.2010)
d.2011 <- extract(r.2011, p.2011)
d.2012 <- extract(r.2012, p.2012)
d.2013 <- extract(r.2013, p.2013)
d.2014 <- extract(r.2014, p.2014)

#get ndep, MAT, MAP, sand, silt, clay
out <- data.frame(d.1985,d.1986, d.1987, d.1988, d.1989, d.1990, d.1991, d.1992, d.1993, d.1994, d.1995, d.1996, d.1997, d.1998, d.1999, d.2000, d.2001, d.2002, d.2003, d.2004, d.2005, d.2006, d.2007, d.2008, d.2009, d.2010, d.2011, d.2012, d.2013, d.2014)
out$ndep <- rowMeans(out, na.rm=T)
product_2$ndep30_wet <- out$ndep
product_2$map  <- extract(map.PRISM, points)
product_2$mat  <- extract(mat.PRISM, points)
product_2$sand <- extract(sand, points)
product_2$silt <- extract(silt, points)
product_2$clay <- extract(clay, points)
#get wet and dry dep separately with new NEFI microbe function
out <- extract_ndep(product_2$LON,product_2$LAT)
product_2 <- cbind(product_2,out)
product_2$tot.15 <- product_2$n.dep

#product_3 loop
points <- points.3
#project your sites into the coordinate reference system (CRS) of each years raster
p.1985 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1985))
p.1986 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1986))
p.1987 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1987))
p.1988 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1988))
p.1989 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1989))
p.1990 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1990))
p.1991 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1991))
p.1992 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1992))
p.1993 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1993))
p.1994 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1994))
p.1995 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1995))
p.1996 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1996))
p.1997 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1997))
p.1998 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1998))
p.1999 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.1999))
p.2000 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2000))
p.2001 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2001))
p.2002 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2002))
p.2003 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2003))
p.2004 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2004))
p.2005 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2005))
p.2006 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2006))
p.2007 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2007))
p.2008 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2008))
p.2009 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2009))
p.2010 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2010))
p.2011 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2011))
p.2012 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2012))
p.2013 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2013))
p.2014 <- spTransform(SpatialPoints(points,proj4string=CRS("+init=epsg:4326")), projection(r.2014))

#now extract Ndep data from all layers.
d.1985 <- extract(r.1985, p.1985)
d.1986 <- extract(r.1986, p.1986)
d.1987 <- extract(r.1987, p.1987)
d.1988 <- extract(r.1988, p.1988)
d.1989 <- extract(r.1989, p.1989)
d.1990 <- extract(r.1990, p.1990)
d.1991 <- extract(r.1991, p.1991)
d.1992 <- extract(r.1992, p.1992)
d.1993 <- extract(r.1993, p.1993)
d.1994 <- extract(r.1994, p.1994)
d.1995 <- extract(r.1995, p.1995)
d.1996 <- extract(r.1996, p.1996)
d.1997 <- extract(r.1997, p.1997)
d.1998 <- extract(r.1998, p.1998)
d.1999 <- extract(r.1999, p.1999)
d.2000 <- extract(r.2000, p.2000)
d.2001 <- extract(r.2001, p.2001)
d.2002 <- extract(r.2002, p.2002)
d.2003 <- extract(r.2003, p.2003)
d.2004 <- extract(r.2004, p.2004)
d.2005 <- extract(r.2005, p.2005)
d.2006 <- extract(r.2006, p.2006)
d.2007 <- extract(r.2007, p.2007)
d.2008 <- extract(r.2008, p.2008)
d.2009 <- extract(r.2009, p.2009)
d.2010 <- extract(r.2010, p.2010)
d.2011 <- extract(r.2011, p.2011)
d.2012 <- extract(r.2012, p.2012)
d.2013 <- extract(r.2013, p.2013)
d.2014 <- extract(r.2014, p.2014)

#get ndep, MAT, MAP, sand, silt, clay
out <- data.frame(d.1985,d.1986, d.1987, d.1988, d.1989, d.1990, d.1991, d.1992, d.1993, d.1994, d.1995, d.1996, d.1997, d.1998, d.1999, d.2000, d.2001, d.2002, d.2003, d.2004, d.2005, d.2006, d.2007, d.2008, d.2009, d.2010, d.2011, d.2012, d.2013, d.2014)
out$ndep <- rowMeans(out, na.rm=T)
product_3$ndep30_wet <- out$ndep
product_3$map  <- extract(map.PRISM, points)
product_3$mat  <- extract(mat.PRISM, points)
product_3$sand <- extract(sand, points)
product_3$silt <- extract(silt, points)
product_3$clay <- extract(clay, points)
#get wet and dry dep separately with new NEFI microbe function
out <- extract_ndep(product_3$longitude,product_3$latitude)
product_3 <- cbind(product_3,out)
product_3$tot.15 <- product_3$n.dep

#rest of subsetted products need extracted data merged in.
product_1.E         <- readRDS(Product_1.E.path); product_1.E <- data.table(product_1.E)
product_2.E         <- readRDS(Product_2.E.path); product_2.E <- data.table(product_2.E)
product_3.E         <- readRDS(Product_3.E.path); product_3.E <- data.table(product_3.E)
product_1.E_nomid   <- readRDS(Product_1.E_nomid.path); product_1.E_nomid <- data.table(product_1.E_nomid)
product_2.E_nomid   <- readRDS(Product_2.E_nomid.path); product_2.E_nomid <- data.table(product_2.E_nomid)
product_3.E_nomid   <- readRDS(Product_3.E_nomid.path); product_3.E_nomid <- data.table(product_3.E_nomid)


#rest of the product need mat, map and clay as well. 
to.merge <- product_1[,.(PLT_CN,dry.dep,wet.dep, tot.15, mat, map, sand, silt, clay)]

#load other products
product_1.E         <- readRDS(Product_1.E.path); product_1.E <- data.table(product_1.E)
product_2.E         <- readRDS(Product_2.E.path); product_2.E <- data.table(product_2.E)
product_3.E         <- readRDS(Product_3.E.path); product_3.E <- data.table(product_3.E)
product_1.E_nomid   <- readRDS(Product_1.E_nomid.path); product_1.E_nomid <- data.table(product_1.E_nomid)
product_2.E_nomid   <- readRDS(Product_2.E_nomid.path); product_2.E_nomid <- data.table(product_2.E_nomid)
product_3.E_nomid   <- readRDS(Product_3.E_nomid.path); product_3.E_nomid <- data.table(product_3.E_nomid)

#Merge in spatial data
product_1.E       <- merge(product_1.E, to.merge, by.x =      'PLT_CN', by.y = 'PLT_CN', all.x=T)
product_2.E       <- merge(product_2.E, to.merge, by.x = 'PREV_PLT_CN', by.y = 'PLT_CN', all.x=T)
product_3.E       <- merge(product_3.E, to.merge, by.x = 'PREV_PLT_CN', by.y = 'PLT_CN', all.x=T)
product_1.E_nomid <- merge(product_1.E_nomid, to.merge, by.x =      'PLT_CN', by.y = 'PLT_CN', all.x=T)
product_2.E_nomid <- merge(product_2.E_nomid, to.merge, by.x = 'PREV_PLT_CN', by.y = 'PLT_CN', all.x=T)
product_3.E_nomid <- merge(product_3.E_nomid, to.merge, by.x = 'PREV_PLT_CN', by.y = 'PLT_CN', all.x=T)


#save output. 
saveRDS(product_1, Product_1.path)
saveRDS(product_2, Product_2.path)
saveRDS(product_3, Product_3.path)
saveRDS(product_1.E, Product_1.E.path)
saveRDS(product_2.E, Product_2.E.path)
saveRDS(product_3.E, Product_3.E.path)
saveRDS(product_1.E_nomid, Product_1.E_nomid.path)
saveRDS(product_2.E_nomid, Product_2.E_nomid.path)
saveRDS(product_3.E_nomid, Product_3.E_nomid.path)

##end script.